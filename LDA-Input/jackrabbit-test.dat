241
patch remov bogus test code check int see 's bigger max_valu imposs remov
patch fix uppercase/lowercas handl equal code miss break switch statement caus uppercas lowercas term equal lucen search patch fix
dbclustertest failur due network configur report serg dbclustertest case fail run certain network configur thoma alreadi suggest fix eclips workspac patch 1.0 p jackrabbit-cor index src/test/java/org/apache/jackrabbit/core/cluster/dbclustertest.java src/test/java/org/apache/jackrabbit/core/cluster/dbclustertest.java revisi 1067983 +++ src/test/java/org/apache/jackrabbit/core/cluster/dbclustertest.java workin g copi -37,9 +37,9 public void setup throw except deleteal server1 server.createtcpserv -tcpport 9001 -basedir ./target/dbclustertest/db1 .start ./target/dbclustertest/db1 -tcpallowoth .start server2 server.createtcpserv -tcpport 9002 -basedir ./target/dbclustertest/db2 .start ./target/dbclustertest/db2 -tcpallowoth .start fileutils.copyfil new file ./src/test/resources/org/apache/jackrabbit/core/cluster/repository-h2 .xml new file ./target/dbclustertest/node1/repository.xml
jcr-2523 break transact handl contain manag environ cleanup return pool jca manag connect new intern session creat object jcamanagedconnect method cleanup suppos fix jcr-2523 sideeffect xa-resourc variable-xaresourc jcamanagedconnect anymor xasessionimpl object like session object subsequ call connect lead intern session variabl anymor inform current transact context xaitemstatemanag variabl tx txlog null xaresourc inform new transact context result complet transact handl work anymor attach sampl project show behaviour
session.importxml close input stream jsr 283/jcr 2.0 http //markmail.org/thread/crwx27dkt2cnjjy7 avail follow node.setproperti string inputstream property.setvalu inputstream valuefactory.createvalu inputstream valuefactory.createbinari inputstream session.importxml string inputstream int workspace.importxml string inputstream int
uncaught abstractmethoderror except domutil.createfactori domutil.createfactori throw uncaught abstractmethoderror except xerc classpath jackrabbit webdav modul use render class unus use conjunct xerc librari
multivalu properti sort last/random valu sort multivalu properti may produc incorrect result sort perform last valu multivalu properti step reproduc 1 creat multivalu field repositori exampl nodetyp file propertydefinit name= myproperti requiredtype= string autocreated= fals mandatory= fals onparentversion= copi protected= fals multiple= fals 2 creat record record except one would contain singl valu myproperti one record would contain first valu greater record second valu somewher middl exampl 1st record aaaa 2nd record cccc 3rd record dddd bbbb 3 run queri sort exampl xpath queri criteria order myproperti ascend queri would return document order aaaa dddd bbbb cccc expect order expect order enter aaaa cccc cccc dddd dig found happen method org.apache.jackrabbit.core.query.lucene.sharedfieldcache.getvalueindex call org.apache.jackrabbit.core.query.lucene.sharedfieldsortcomparator.simplescoredoccompar constructor return last compar document overwrit previous valu retarray termdocs.doc getvalu valu type tri concaten compar check would work case retarray termdocs.doc null retarray termdocs.doc getvalu valu type els retarray termdocs.doc retarray termdocs.doc getvalu valu type n't work well either termenum return term order jackrabbit return valu multivalu field exampl qwer asdf may becom asdf qwer simpl concaten n't help
entrycollectortest failur certain java version testcach test case entrycollectortest class use array comparison set permiss caus test failur certain java version order permiss differ expect
creat accesscontrolentryimpl base entri result wrong restrict creation new accesscontrolentryimpl use base entri restrict base entri copi new instanc
avoid string.intern index lucen 3.0 allow creat field string name alreadi intern use new constructor nodeindex avoid unnecessari string.intern call field name jackrabbit use avail fieldnam alreadi intern
index configur ignor index length nodeindex respect index configur add field properti length nodeindexer.addvalu document doc internalvalu valu name name check properti actual need index
avoid unnecessari index reader call use aggreg definit searchindex.retrieveaggregateroot set nodeid removedid map nodeid nodest map identifi aggreg root node base remov node aggreg rule defin index configur process requir index lookup method optim case node remov unnecessari call index reader avoid
secur token base authent token base authent implement jcr-2851 seem exhibit secur issu token return server consist identifi newli creat node repositori attack abl guess acquir mean i.e via log file identifi grant access repositori wors yet jcr-2857 introduc sequenti node id guess piec cake setup think decoupl authent secret node id simpl solut would store secret token attribut deleg generat secret dedic handler handler use secur random generat private/publ key encrypt whatev method deem appropri generat authent secret initi discuss see http //markmail.org/thread/aspetgvmj2qud25a
workspace.copi src dest throw unexpect repositoryexcept invalid path use davex remot layer jcr2spi- spi2davex follow code fragment caus unexpect repositoryexcept snip node testnode1 session.getrootnod .addnod test nt folder node copydestin testnode1.addnod copydestin nt folder testnode1.addnod copysourc nt folder .addnod testcopycommand nt folder .addnod abc nt folder session.sav copydestination.addmixin mix referenc session.sav session.getworkspac .copi /test/copysource/testcopycommand /test/copydestination/testcopycommand /snip caus javax.jcr.repositoryexcept invalid path /test/copydestination//testcopycommand sun.reflect.nativeconstructoraccessorimpl.newinstance0 nativ method sun.reflect.nativeconstructoraccessorimpl.newinst nativeconstructoraccessorimpl.java:39 sun.reflect.delegatingconstructoraccessorimpl.newinst delegatingconstructoraccessorimpl.java:27 java.lang.reflect.constructor.newinst constructor.java:513 org.apache.jackrabbit.spi2dav.exceptionconverter.gener exceptionconverter.java:69 org.apache.jackrabbit.spi2dav.exceptionconverter.gener exceptionconverter.java:51 org.apache.jackrabbit.spi2dav.repositoryserviceimpl.execut repositoryserviceimpl.java:482 org.apache.jackrabbit.spi2dav.repositoryserviceimpl.copi repositoryserviceimpl.java:1307 org.apache.jackrabbit.spi2davex.repositoryserviceimpl.copi repositoryserviceimpl.java:326 org.apache.jackrabbit.jcr2spi.workspacemanag operationvisitorimpl.visit workspacemanager.java:889 org.apache.jackrabbit.jcr2spi.operation.copy.accept copy.java:48 org.apache.jackrabbit.jcr2spi.workspacemanag operationvisitorimpl.execut workspacemanager.java:848 org.apache.jackrabbit.jcr2spi.workspacemanag operationvisitorimpl.access 400 workspacemanager.java:793 org.apache.jackrabbit.jcr2spi.workspacemanager.execut workspacemanager.java:581 org.apache.jackrabbit.jcr2spi.workspaceimpl.copi workspaceimpl.java:149 howev follow slight alter code fragment work expect snip node testnode1 session.getrootnod .addnod test nt folder node copydestin testnode1.addnod copydestin nt folder testnode1.addnod copysourc nt folder .addnod testcopycommand nt folder .addnod abc nt folder session.sav copydestination.addmixin mix referenc session.sav testnode1.addnod copydestin nt folder .addmixin nodetype.mix_referenc node n testnode1.addnod copysourc nt folder .addnod testcopycommand nt folder .addnod abc nt folder session.sav session.getworkspac .copi /test/copysource/testcopycommand /test/copydestination/testcopycommand /snip
uriresolverimpl use bitwis instead logic oper uriresolverimpl line 111 path null cache.containsitemid uuidid
jcrparser use bitwis instead logic oper jcrparser line 134 insidesinglequot insidedoublequot charact
sql2 parser improv error messag ambigu properti join queri form select id parent inner join child parent.id=child.parentid sql2 parser current return generic error messag queri result contain one selector error messag point problemat token queri select id parent inner join child parent.id=child.parentid expect need specifi selector name id queri contain one selector
various inner class maintain refer own class reason various inner class maintain refer own class reason independ class issu chang class static inner class footprint decreas eas gc work potenti reduc lifetim own class outliv owner
defaultprotectedpropertyimport mask sever field parent caus potenti deriv class perform correct field session resolv referencetrack duplic defaultprotectedpropertyimport defaultprotecteditemimport thus futur deriv class function correct attempt use field null plan remov defaultprotectedpropertyimport
lucenequeryfactori call queryhits.clos run queri lucenequeryfactori respons jcr_sql2 implement close queryhit run queri
various place map lookup loop instead use entryset iter various place loop keyset iter map look time thru loop plan convert place use entryset iter avoid
name child node disappear restor restor version node sever non-version child node name child node disappear node node session.getrootnod .addnod mynod node.addmixin mix version int 1 6 i++ node child node.addnod child child.setproperti name child_ +i session.sav versionmanag versionmanag session.getworkspac .getversionmanag versionmanager.checkin node.getpath system.out.println number child node node.getnod .getsiz versionmanager.checkout node.getpath node.getnod child .setproperti name modifi session.sav version basevers versionmanager.getbasevers node.getpath versionmanager.restor basevers true system.out.println number child node restor node +node.getnod .getsiz produc follow output number child node 5 number child node restor node 3 give uniqu name ad mixin version child node solv problem
compat issu admin imperson admin session revis 1076596 made improv impersonationimpl remov shortcut adminprincip point view problemat howev introduc follow compat issu detect tom accord test user allow imperson jcr n't total clear state session.imperson use imperson anoth possibl admin-us due shortcut mention order break exist code reli special case would suggest chang code accord
sql2 left outer join creat node def n1 root.addnod node1 sling samplepag n1.setproperti n1prop1 page1 def n2 n1.addnod node2 sling samplecont n2.setproperti n2prop1 content1 execut queri select sling samplepag page left outer join sling samplecont content isdescendantnod content page page.n1prop1 page1 content.n2prop1 content1 resultset 1 row 2 node ok. execut select sling samplepag page left outer join sling samplecont content isdescendantnod content page page.n1prop1 page1 content.n2prop1 xxxxx resultset 1 row 1 node wrong result 0 row old version prior 2.2.2 also 0 row result also node n2 exist jackrabbit report 1 row result
sql2 queri log sql2 queri construct via queryobjectmodel ran via queryobjectmodelimpl log run time ll attach run time log similar old one
jmx bind jackrabbit slight interest past ad jmx support would first stab top 15 slow queri log 15 part configur enabl default affect overal perform much enabl play littl tell think ve also ad test case durat comparison without logger import part issu open way proper monitor tool support around queri cach anything/everyth jackrabbit usual pleas let know guy think
acl glob restrict work '/ tri defin acl '/ would allow read '/ node underneath tri none seem desir effect eg everyon allow jcr read everyon deni jcr read '/ glob= work non-root node
queryobjectmodel generat correspond sql2 queri deal space path origin issu tri get childnod node name /a b use follow code querymanag querymanager=session.getworkspac .getquerymanag queryobjectmodelfactori qomf=querymanager.getqomfactori sourc source1=qomf.selector nodetype.nt_bas selector_0 column column new column qomf.column selector_0 null null constraint constraint2 qomf.childnod selector_0 /a b queryobjectmodel qom qomf.createqueri source1 constraint2 null column give result session acquir webdav connect use jndi give child node sql statement get creat select selector_0 nt base selector_0 ischildnod selector_0 /a b use webdav give sql2 queri direct along quot around path i.e /a b work expect n't anyth webdav problem queryobjectmodel generat sql2 queri 100 equival fail escap path space way case davex remot jr client use statement generat instead escap fail return expect node seen easili system.out.println qom.getstat
privilegedefinit implement equal hashcod
move privileg reader/writ spi-common use qualifi name current privileg reader jcr-common use privilegedefinit base pure string rather qualifi name suggest move spi-common use org.apache.jackrabbit.spi.nam privileg name
usermanag membership cach default size small membership cach introduc jcr-2703 make use lrumap cach group membership authoriz nodeid group nodeid environ user belong 100 group cach quick becom ineffect due default maximum size lrumap cach limit hit rather expens node getweakrefer api call result search queri execut lead quit notic perform drop thus 'd suggest either make membership cach configur introduc logic let cach grow dynam need still kind hard limit avoid memori issu
remov unnecessari nodeimpl refer lucenequeryfactori lucenequeryfactori cast nodeimpl get node id info avail via api well cast seem unnecessari ll attach patch tini issu
token authent paramet load jaa configur token base authent disabl expir time set login modul config howev work local auth context use jaa configur
jcr-server improv implement davresourc getproperti davpropertynam issu alreadi describ jcr-397 problem even subset properti request client dav resourc initi complet set properti
jcr-server add possibl propfind jcr_nodetypes_cnd_ln properti patch uwe jaeger see jcr-2454 n't includ resolut jcr-2454 sinc would like jcr-2946 fix prerequisit
item.remov fail child-item visibl edit session follow test setup fail given session allow remov node node polici child node visibl edit session miss ac-read permiss node anoth invis child item could base permiss remov session call node.remov howev fail accessdeniedexcept intern remov mechan access child item mark remov howev access execut use regular itemmgr call use retriev item use jcr api result accessdeni except child item visibl session sinc item remov would argu bug intern remov process
privilegehandlertest fail window test fail window differ line break expect actual result
pathpars accept illeg path contain cur bracket o.a.jackrabbit.spi.commons.conversion.pathpars accept follow path /public/. /privat normal result path object repres /privat 's potenti secur risk
sql-2 queri return request column select alia jcr titl jnt maincont alia iter return column row get result select jnt maincont properti defin jnt maincont use select alia jcr titl titl jnt maincont alia result limit titl column
use growinglrumap cachingentrycollector order allow flexibl cach size cach entri collect would like use growinglrumap
sql2 implement like support node name like constraint local name node throw javax.jcr.unsupportedrepositoryoperationexcept
improv password hash
long valu proper store long valu assign properti big restart server valu becom 0 test pass version 1.6.4 2.0
improv log session.sav trace back root caus extern modifi node current 's difficult find root caus error like javax.jcr.invaliditemstateexcept uuid modifi extern better trace back issu would nice add debug log session.sav call
inputstream explicit close deploy j2ee artifact use jackrabbit org.apache.jackrabbit.core.persistence.pool.mysqlpersistencemanag glassfish start complain input stream without explicit close specif inputstream mey found org.apache.jackrabbit.core.persistence.pool.bundledbpersistencemanager.createcheckschemaoper bundledbpersistencemanager.java:584 ve check code bundledbpersistencemanager:530 run method invok object checkschemaoper run method checkschemaoperation:78 final block call ioutils.closequiet ddl close stream insid condit conhelper.tableexist tabl checkschemaoperation:79 condit fals inputstream explicit close opinion two fix altern robust 1 insert final method overrid protect void final throw throwabl ddl =null ioutils.closequiet ddl super.fin anoth altern 2 put condit conhelper.tableexist tabl insid try-fin block stacktrac |2011-05-05t11:43:28.087-0300|warning|glassfish3.1|javax.enterprise.system.core.classloading.com.sun.enterprise.loader|_threadid=1233 _threadname=thread-1 |input stream final forc close without explicit close stream instanti report follow stack trace java.lang.throw com.sun.enterprise.loader.asurlclassload sentinelinputstream. init asurlclassloader.java:1230 com.sun.enterprise.loader.asurlclassload internaljarurlconnection.getinputstream asurlclassloader.java:1338 java.net.url.openstream url.java:1010 java.lang.classloader.getresourceasstream classloader.java:1195 com.sun.enterprise.loader.asurlclassloader.getresourceasstream asurlclassloader.java:872 java.lang.class.getresourceasstream class.java:2030 org.apache.jackrabbit.core.persistence.pool.bundledbpersistencemanager.createcheckschemaoper bundledbpersistencemanager.java:584 org.apache.jackrabbit.core.persistence.pool.bundledbpersistencemanager.init bundledbpersistencemanager.java:530 org.apache.jackrabbit.core.persistence.pool.mysqlpersistencemanager.init mysqlpersistencemanager.java:51 org.apache.jackrabbit.core.repositoryimpl.createpersistencemanag repositoryimpl.java:1353
itemsaveoper swallow stacktrac staleitemstateexcept thrown stacktrac swallow make much harder figur went wrong log
show referenc node debug log tri delet node refer use tri analyz error non-interact applic product environ
sessionitemstatemanager.getidofroottransientnodest may caus npe regress jcr-2425 certain scenario call sessionitemstatemanager.getidofroottransientnodest may caus npe test case repositori repositori new transientrepositori session session repository.login new simplecredenti admin admin .tochararray session session2 repository.login new simplecredenti admin admin .tochararray tri session.getrootnod .hasnod test session.getrootnod .getnod test .remov node test session.getrootnod .addnod test session.sav node x test.addnod x session.sav node x2 session2.getrootnod .getnod test .getnod x x2.remov x.addnod b session2.sav session.sav throw npe final session.logout session2.logout
filedatastor garbag collect throw nullpointerexcept i/o problem filedatastor throw npe garbag collect file i/o problem exampl access right problem reason n't check file.list listfil return null stack trace except thread thread-461 java.lang.nullpointerexcept org.apache.jackrabbit.core.data.filedatastore.deleteolderrecurs filedatastore.java:334 org.apache.jackrabbit.core.data.filedatastore.deleteolderrecurs filedatastore.java:328 org.apache.jackrabbit.core.data.filedatastore.deleteolderrecurs filedatastore.java:328 org.apache.jackrabbit.core.data.filedatastore.deleteolderrecurs filedatastore.java:328
revert subsequ token-nod updat tentat introduc would like revert improv tentat introduc base follow thread dev list http //www.mail-archive.com/dev jackrabbit.apache.org/msg24437.html still concern undesir effect addit still feel somehow violat basic contract
allow name set propertyinfobuild nodeinfobuild current properti name new properti node set builder creat suggest add method set name
iteminfobuild includ propertyinfo childinfo build nodeinfo instanc use iteminfobuild getchildinfo return entri popertyinfo wrong getchildinfo includ entri child node
make iteminfobuild name space awar current way nodeinfobuilder/propertyinfobuild build nodeinfos/iteminfo name space default one suggest add appropri method nodeinfobuilder/propertyinfobuild set name space
allow parent path set explicit nodeinfobuild current way explicit set parent nodeinfo build nodeinfobuild suggest add setparentpath method nodeinfobuild fix
accesscontrolmanag getapplicablepolici check collid rep polici node accesscontrolmanag getapplicablepolici return empti iter target node get accesscontrollable-mixin set test collid child node would prevent polici appli call accesscontrolmanag setpolici consequ setpolici call fail itemexistsexcept simpl test upfront could prevent unexpect failur
add accessor parent nodeinfobuilder/propertyinfobuild nodeinfobuild propertyinfobuild allow access respect parent suggest add getpar method class
deprec repositoryservice.getnodeinfo method suggest deprec repositoryservice.getnodeinfo favor repositoryservice.getiteminfo former method call jsr2spi anymor thus requir
node properti mark async extract avail queri problem appear deal node async extractor case return lightweight copi node without properti process background copi algorithm ignor certain field type probabl introduc lucen 3 upgrad sure singletontokenstream lightweight copi includ exist properti therefor node appear queri extract time
bundl event may drop due np 1 resolv fail lookup node entri np thrown except break loop forward event observ 2 result observ receiv event 1 org.apache.jackrabbit.jcr2spi.hierarchy.hierarchymanagerimpl lookup itemid workspaceitemid 2 org.apache.jackrabbit.jcr2spi.workspacemanag oneventreceiv eventbundl eventbundl internaleventlisten lstnrs
jcr2spi namespaceregistryimpl.unregisternamespac pass prefix storag uri expect tri unregist namespac spi jackrabbit throw namespaceexcept prefix regist namespac uri javax.jcr.namespaceregistry.unregisternamespac string prefix expect namespac prefix though org.apache.jackrabbit.jcr2spi.namespaceregistryimpl.unregisternamespac string prefix call direct org.apache.jackrabbit.jcr2spi.namespacestorage.unregisternamespac string uri expect namespac uri namespac registri first retriev uri provid prefix
new jcrutil util method 'd like add follow new util method jcrutil readfil node return inputstream read file content readfil node outputstream write file content given stream getlastmodifi node return jcr lastmodifi valu setlastmodifi node calendar set jcr lastmodifi valu getpropertytyp string like propertytype.valuefromnam string case-insensit
support embed index aggreg index aggreg could contain index aggreg jr abl handl complet hierarchi aggreg 'm work patch
jcr-server defaultitemcollect unlock call davsess removerefer defaultitemcollect unlock remov token-refer davsess ad upon creat lock caus pend lock-refer thus cach entri jcrwebdavserv clear fill cach although lock proper releas
add method set uuid nodeinfobuild
add method remov map namespacemap o.a.j.spi.commons.namespace.namespacemap current mean remov map suggest add method public string removemap string uri
jcr2spi creat changepol thread demand current new changepol thread creat everi singl session even neither observ eventlisten cachebehaviour observ think could creat demand
qom sql2 n't cast numer liter sql2 statement generat queryobjectmodel.getstat n't contain cast numer liter type decim doubl long type inform lost result incorrect queri result depend queri engin generat sql2 statement execut
access control evalu proper cope xa transact follow test fail itemnotfoundexcept indic posit due fact parent n2 exist still visibl system session respons ac evalu public void testtransact throw except make sure testus privileg privileg privileg privilegesfromnam privilege.jcr_al giveprivileg path privileg getrestrict superus path creat new node lock session gettestsess usertransact utx new usertransactionimpl utx.begin add node save node n s.getnod childnpath n.hasnod nodename1 node c n.getnod nodename1 c.remov s.save node n2 n.addnod nodename1 s.save node n3 n2.addnod nodename2 s.save except commit utx.commit possibl workaround would make sure itemsaveoperation.persisttransientitem retriev parent without checkpermiss enabl sinc assum new item could ad parent readabl first place care evalu would requir note one exampl ac-evalu proper deal xa transact convinc exampl could find
sql2 join claus still issu still issu join claus chang test reflect chang
descendantselfaxisqueri may fail ioexcept session limit access descendantselfaxisqueri use current session look node id session access node except incorrect re-thrown ioexcept instead itemnotfoundexcept caught ignor probabl regress caus jcr-1365 introduc jackrabbit 1.5
add read acessor user data sessioninfoimpl add method sessioninfoimpl.getuserdata retriev user data set sessioninfoimpl.setuserdata string
tika configur may use wrong class loader configur tika parser construct mechan ad jcr-2864 construct parser instanc lazili first index request made may confus thing context class loader use tika load avail parser class may alway class loader use creat repositori avoid problem tika parser construct alreadi normal repositori initi
check dav-request label header check 's version-control look mysql log realiz jackrabbit dav request call version tabl everi time get new node cach yet even simpl getnod version tabl get pretti larg may perform impact found davresourcefactoryimpl check node version decid check label header later check anoth version get request re-ord check first check 's http label-head check node version check label header much faster check db 's version scale much better
make possibl get multipl node one call via davex 'm work current
usermanag concurr user creation use intermedi path fail concurr creat user use intermedi path fail node modifi extern problem intermedi path n't exist multipl thread tri creat concurr o.a.jackrabbit.core.security.user.usermanagerimpl line 1310ff string segmt defaultpath.split nodeimpl folder nodeimpl session.getrootnod string authroot isgroup groupspath userspath string segment segmt segment.length 1 continu folder.hasnod segment folder nodeimpl folder.getnod segment text.isdescendantorequ authroot folder.getpath folder.isnodetyp nt_rep_authorizable_fold throw new constraintviolationexcept invalid intermedi path must type rep authorizablefold els node parent folder folder addnod folder session.getqnam segment nt_rep_authorizable_fold attach test case illustr issue/
setproperti access control evalu proper cope xa transact anoth instanc problem acl evalu within transact describ https //issues.apache.org/jira/browse/jcr-2999 case propertyimpl getpar call propertyimpl checksetvalu tri check read permiss yet uncommit parent thus fail itemnotfound except problem reproduc follow test public void testtransact throw except make sure testus privileg privileg privileg privilegesfromnam privilege.jcr_al giveprivileg path privileg getrestrict superus path creat new node lock session gettestsess usertransact utx new usertransactionimpl utx.begin add node save node n s.getnod childnpath n.hasnod nodename1 node c n.getnod nodename1 c.remov s.save creat node save node n2 n.addnod nodename1 s.save node new failur set properti child node uncommit parent n2.setproperti propertyname1 testsetproperti s.save fail propertyimpl getpar call propertyimpl checksetvalu check read permiss yet commit parent commit utx.commit
prefix fulltext queri japanes chines charact fail match prefix fulltext queri japanes chines charact match prefix part token mean prefix length 1 sequenc charact taken one term index lookup match anyth index time charact alway broken individu token
fix incorrect indexingqueuetest logic indexingqueuetest class assum session.sav call push pend text extract task index queue fact still kept wait volatileindex
arrayindexoutofboundsexcept concurrentcach arrayindexoutofboundsexcept sever day uptim 'm experienc strang arrayindexoutofboundsexcept access jackrabbit concurrentcach 2.2.5. line 241 shrinkifneed check caus java.lang.arrayindexoutofboundsexcept -14 org.apache.jackrabbit.core.cache.concurrentcache.shrinkifneed concurrentcache.java:241 review jackrabbit-cod 'm sure 's caus atomicinteg realiz accesscount abstractcach becom negat increas integer.max_valu constant semi-random start index prevent bias first segment int start int getaccesscount segments.length int start istoobig 1 segments.length synchron segment ___________________________ uncaught throwabl java.lang.arrayindexoutofboundsexcept -7 org.apache.jackrabbit.core.cache.concurrentcache.shrinkifneed concurrentcache.java:241 org.apache.jackrabbit.core.cache.concurrentcache.put concurrentcache.java:176 org.apache.jackrabbit.core.persistence.bundle.abstractbundlepersistencemanager.getbundl abstractbundlepersistencemanager.java:657 org.apache.jackrabbit.core.persistence.bundle.abstractbundlepersistencemanager.load abstractbundlepersistencemanager.java:400 org.apache.jackrabbit.core.state.shareditemstatemanager.loaditemst shareditemstatemanager.java:1819 org.apache.jackrabbit.core.state.shareditemstatemanager.getnonvirtualitemst shareditemstatemanager.java:1739 org.apache.jackrabbit.core.state.shareditemstatemanager.getitemst shareditemstatemanager.java:261 org.apache.jackrabbit.core.state.localitemstatemanager.getnodest localitemstatemanager.java:107 org.apache.jackrabbit.core.state.localitemstatemanager.getitemst localitemstatemanager.java:172 org.apache.jackrabbit.core.state.xaitemstatemanager.getitemst xaitemstatemanager.java:260 org.apache.jackrabbit.core.state.sessionitemstatemanager.getitemst sessionitemstatemanager.java:161 org.apache.jackrabbit.core.itemmanager.getitemdata itemmanager.java:370 org.apache.jackrabbit.core.itemmanager.getitem itemmanager.java:316 org.apache.jackrabbit.core.itemmanager.getitem itemmanager.java:610 org.apache.jackrabbit.core.sessionimpl.getnodebyid sessionimpl.java:493 org.apache.jackrabbit.core.sessionimpl.getnodebyidentifi sessionimpl.java:1045 sun.reflect.generatedmethodaccessor31.invok unknown sourc sun.reflect.delegatingmethodaccessorimpl.invok delegatingmethodaccessorimpl.java:25 java.lang.reflect.method.invok method.java:597 org.apache.sling.jcr.base.sessionproxyhandl sessionproxyinvocationhandler.invok sessionproxyhandler.java:109 proxy2.getnodebyidentifi unknown sourc de.dig.cms.frontend.servlet.helper.resourceutil.findresourcebyid resourceutil.java:44 de.dig.cms.frontend.servlet.cmscontentenrichservletfilter.dofilt cmscontentenrichservletfilter.java:194 org.apache.sling.engine.impl.filter.abstractslingfilterchain.dofilt abstractslingfilterchain.java:60 de.dig.cms.frontend.servlet.cachecontrolfilter.dofilt cachecontrolfilter.java:120 org.apache.sling.engine.impl.filter.abstractslingfilterchain.dofilt abstractslingfilterchain.java:60 de.dig.cms.cache.impl.wallcacheservletfilter.processcacheablerequest wallcacheservletfilter.java:244 de.dig.cms.cache.impl.wallcacheservletfilter.processcacheablerequestwithlatch wallcacheservletfilter.java:185 de.dig.cms.cache.impl.wallcacheservletfilter.dofilt wallcacheservletfilter.java:154 org.apache.sling.engine.impl.filter.abstractslingfilterchain.dofilt abstractslingfilterchain.java:60 de.dig.cms.frontend.servletapi.cmsslinghttpservletrequestfilter.dofilt cmsslinghttpservletrequestfilter.java:52 org.apache.sling.engine.impl.filter.abstractslingfilterchain.dofilt abstractslingfilterchain.java:60 org.apache.sling.engine.impl.slingmainservlet.servic slingmainservlet.java:313 org.apache.sling.engine.impl.slingmainservlet.servic slingmainservlet.java:207 org.mortbay.jetty.servlet.servletholder.handl servletholder.java:502 org.mortbay.jetty.servlet.servlethandler.handl servlethandler.java:389 org.ops4j.pax.web.service.internal.httpserviceservlethandler.handl httpserviceservlethandler.java:64 org.mortbay.jetty.servlet.sessionhandler.handl sessionhandler.java:181 org.mortbay.jetty.handler.contexthandler.handl contexthandler.java:765 org.ops4j.pax.web.service.internal.httpservicecontext.handl httpservicecontext.java:111 org.ops4j.pax.web.service.internal.jettyserverhandlercollection.handl jettyserverhandlercollection.java:64 org.mortbay.jetty.handler.handlerwrapper.handl handlerwrapper.java:152 org.mortbay.jetty.server.handl server.java:324 org.mortbay.jetty.httpconnection.handlerequest httpconnection.java:535 org.mortbay.jetty.httpconnect requesthandler.headercomplet httpconnection.java:865 org.mortbay.jetty.httpparser.parsenext httpparser.java:539 org.mortbay.jetty.httpparser.parseavail httpparser.java:212 org.mortbay.jetty.httpconnection.handl httpconnection.java:404 org.mortbay.io.nio.selectchannelendpoint.run selectchannelendpoint.java:409 org.mortbay.thread.queuedthreadpool poolthread.run queuedthreadpool.java:520
identifi path inexist item throw except follow fail repositoryexcept rather return fals session.itemexist uuid.randomuuid
entrycollector may log warn inexist item current entrycollector may log warn node report event exist may happen repositori run cluster node creat immedi remov issu relat jcr-3014 call session.nodeexist actual return fals identifi path resolv current throw repositoryexcept
inconsist repositori overlap node add oper seem reproduc sequenc oper caus repositori inconsist short version 2 session add same-nam child node parent folder allow same-name-s session 1 's save succeed session 2 's save fail succeed retri oper child node creat session 1 still present parent n't list child node anymor add test case
version histori recoveri fail case version jcr frozennod jcr-2551 place version recoveri mode introduc problem case version encount miss mandatori jcr frozennod internalerror thrown o.a.j.c.version.internalversionhistoryimpl createversioninst sinc o.a.j.c.repositorycheck checkversionhistori catch except fail catch proper lead complet repositori shutdown throw exampl runtimeexcept instead fix problem
repositoryimpl.activesess use session instead sessionimpl turn map sessionimpl sessionimpl activesess map session session activesess clear need use sessionimpl
abstractrepositoryservic abl handl guestcredenti abstractrepositoryservice.createsessioninfo handl guestcredenti current handl simplecredenti
spi node.setproperti null valu throw itemnotfoundexcept node.setproperti null valu throw itemnotfoundexcept case properti given name exist rather return stale properti throw invaliditemstateexcept method access behavior also consist jackrabbit-cor
npe consolidatingchangelog hassn nodeid method consolidatingchangelog throw npe nodeid null rather return fals
davex remot perform bottleneck due limit 2 http connect spi2dav servic implement use httpclient support configur maximum amount http connect server default valu httpclient code two perform bottleneck work make number connect configur via paramet map pass repositori factori also fix concurr issu expos increas concurr effect work fix replac hashmap cach client connect concurrenthashmap thank java 1.5 avail jackrabbit 2.x usag set number connect spi2davrepositoryservicefactory.param_max_http_connect creat factori via dav davex rep factori default 20 note see also server side fix jcr-3027 patch ticket allow configur concurr level server tune conjunct client side connect level
jcr server concurr issu jcrwebdavserver.sessioncach intern hashmap cach davex remot perform work outlin jcr-3026 increas concurr jcr server expos lot error relat get put jcrwebdavserver.sessioncach 's intern hashmap 's problem hashmap 's well known concurr error easili fix upgrad map concurrenthashmap perform seem dramat better fix includ exposur tune paramet allow user set expect concurr level number concurr request expect server handl typic davex remot scenario mean tune server side valu match total max connect client point server see jcr-3026 usag set concurrency-level init param jcrremotingservlet via web.xml jackabbit-webapp compon default valu 50 interven lower level api appropri
jcrremotingservlet interpol system properti home init-param deploy scenario jackrabbit war file deploy multipl time server current work directori use home init-param support system properti interpol
permit use differ tablespac tabl index oracl oraclefilesystem oraclepersistencemanag oracledatabasejourn alreadi provid tablespac paramet custom ddl tablespac use tabl index common place use distinct tablespac jackrabbit could provid support
qdefinitionbuilderfactori auto-subtyp nt base similar jcr-2066 qnodetypedefinit build qdefinitionbuilderfactori auto subtyp nt base
provid method write name space declar compactnodetypedefwrit current compactnodetypedefwrit includ configur name space declar name space actual use node type definit written situat necessari write addit name space declar thus propos add method writenamespacedelclar
webdav/davex servlet suscept csrf attack webdav remot davex servlet suscept csrf attack
add getpath method authoriz interfac current way retriev path item associ authoriz check princip obtain authoriz getprincip itembasedprincip getpath method would provid conveni shortcut would addit allow determin realli item associ authoriz access edit session necessarili case itembasedprincip getpath
jmx stat session ve name core stat includ number session current open session read write oper per second stat refresh minut disabl default affect perform
jcr-common add cnd writer function current jcr-common provid cnd-reader writer function present spi-common jcr-2948 implement independ cnd-writer would use would therefor suggest add jcr-common base code present spi-common let implement spi-common extend general function
remov importcontextimpl getdetector method importcontextimpl getdetector refer interfac method importcontext exist accord jukka leftov sinc method use would therefor suggest remov altogeth remov instanc field deprec constructor take detector param
resourceconfig read addit paramet iohandl propertyhandl cover public setter reason current default node type use defaulthandl chang use resourc config bit cumbersom lead useless copi defaultiomanag
improv except handl observ changepol current intern event listen throw except event listen skip happen move event hierarchylisten throw unsupportedoperationexcept suggest move except handler call chain except caught log per listen instead listen
operandevalu abl handl node well row operandevalu use evalu operand valu given row effort improv sort part sql2 jcr-2959 need handl plain node well small chang operandevalu alreadi extract node info row obvious reason expos node oper direct
upgrad latest apach parent pom re quit bit behind latest greatest apach parent pom org.apach apach most sinc re inherit most unus org.apache.jackrabbit parent pom 'd like move thing back o.a.j parent pom jackrabbit-par pom 's locat insid trunk allow us upgrad latest apach parent pom without troubl extra releas o.a.j parent pom
npe consolidatingchangelog id base nodeid consolidatingchangelog guard guard null path valu nodeid
nullpointerexcept remov node acquir search result code snip like follow get nullpointerexcept itemst session repo.login sc workspac querymanag qm s.getworkspac .getquerymanag queri q qm.createqueri select nt unstructur query.jcr_sql2 queryresult r q.execut nodeiter r.getnod node n i.nextnod n.remov break nullpointerexcept except thread main java.lang.nullpointerexcept org.apache.jackrabbit.jcr2spi.state.itemstate.getpar itemstate.java:210 org.apache.jackrabbit.jcr2spi.operation.remove.cr remove.java:98 org.apache.jackrabbit.jcr2spi.itemimpl.remov itemimpl.java:306
abstractlocktest.testlockexpir fail intermitt seem time issu propos wait bit longer lock expir
spi2dav avoid reus document repositoryserviceimpl instead call creat 's document credit due jukka seem avoid odd npe domutil
deprec repositoryservice.getpropertyinfo method would like deprec ultim remov repositoryservice.getpropertyinfo method extend repositoryservice.getiteminfo take function getiteminfo would thus chang method use batch-read persist storag return code iteminfo /code given code itemid /code first element code iter /code addit iter may contain arbitrari code iteminfo /code public iter extend iteminfo getiteminfo sessioninfo sessioninfo itemid itemid throw itemnotfoundexcept repositoryexcept
npe event poll thread except occur run jcr2dav integr test surfac side effect jcr-3046 root caus refresh event guard null valu return event.getitemid
jcr-common add util translat string authorizablequeri execut user manag would conveni jackrabbit-jcr-common would provid util generat authoriz queri string
iteminfobuild fail set correct path properti happen parent node 's nodeid id base contrast path base build method reli nodeid provid full path instead us parent node 's getpath method construct full path
bundledump analyz broken bundl bundleread fail ca n't read bundl tool analyz broken bundl
move filteriter sizediter packag flat packag iter suggest move said class packag org.apache.jackrabbit.commons.flat packag org.apache.jackrabbit.commons.iter
nullpointerexcept itemmanag lot occur java.lang.nullpointerexcept org.apache.jackrabbit.core.itemmanager.getdefinit itemmanager.java:206 org.apache.jackrabbit.core.itemdata.getdefinit itemdata.java:99 org.apache.jackrabbit.core.abstractnodedata.getnodedefinit abstractnodedata.java:73 org.apache.jackrabbit.core.nodeimpl.getdefinit nodeimpl.java:2430 org.apache.jackrabbit.core.itemvalidator.isprotect itemvalidator.java:373 org.apache.jackrabbit.core.itemvalidator.checkcondit itemvalidator.java:273 org.apache.jackrabbit.core.itemvalidator.checkremov itemvalidator.java:254 org.apache.jackrabbit.core.itemremoveoperation.perform itemremoveoperation.java:63 org.apache.jackrabbit.core.session.sessionstate.perform sessionstate.java:200 org.apache.jackrabbit.core.itemimpl.perform itemimpl.java:91 org.apache.jackrabbit.core.itemimpl.remov itemimpl.java:322 org.apache.jackrabbit.core.npeandcmetest testtask.run npeandcmetest.java:87 java.lang.thread.run thread.java:679 ll attach junit test reproduc except
concurrentmodificationexcept finegrainedismlock report finegrainedismlock throw concurrentmodificationexcept stacktrac jackrabbit 2.2.x java.util.concurrentmodificationexcept java.util.hashmap hashiterator.nextentri hashmap.java:793 java.util.hashmap keyiterator.next hashmap.java:828 org.apache.jackrabbit.core.state.finegrainedismlock lockmap.hasdepend finegrainedismlocking.java:388 org.apache.jackrabbit.core.state.finegrainedismlocking.acquirewritelock finegrainedismlocking.java:138 org.apache.jackrabbit.core.state.shareditemstatemanager.acquirewritelock shareditemstatemanager.java:1848 org.apache.jackrabbit.core.state.shareditemstatemanager.access 200 shareditemstatemanager.java:113 org.apache.jackrabbit.core.state.shareditemstatemanag update.begin shareditemstatemanager.java:563 org.apache.jackrabbit.core.state.shareditemstatemanager.beginupd shareditemstatemanager.java:1457 org.apache.jackrabbit.core.state.shareditemstatemanager.upd shareditemstatemanager.java:1487 org.apache.jackrabbit.core.state.localitemstatemanager.upd localitemstatemanager.java:351 org.apache.jackrabbit.core.state.xaitemstatemanager.upd xaitemstatemanager.java:354 org.apache.jackrabbit.core.state.localitemstatemanager.upd localitemstatemanager.java:326 org.apache.jackrabbit.core.state.sessionitemstatemanager.upd sessionitemstatemanager.java:289 org.apache.jackrabbit.core.itemsaveoperation.perform itemsaveoperation.java:258 org.apache.jackrabbit.core.session.sessionstate.perform sessionstate.java:200 org.apache.jackrabbit.core.itemimpl.perform itemimpl.java:91 org.apache.jackrabbit.core.itemimpl.sav itemimpl.java:329 org.apache.jackrabbit.core.session.sessionsaveoperation.perform sessionsaveoperation.java:42 org.apache.jackrabbit.core.session.sessionstate.perform sessionstate.java:200 org.apache.jackrabbit.core.sessionimpl.perform sessionimpl.java:355 org.apache.jackrabbit.core.sessionimpl.sav sessionimpl.java:758
use one schedul repositori task still timer instanc use jackrabbit would better task schedul central scheduledexecutorservic thread pool repositori
remov timeout handl transactioncontext discuss jcr-2861 transact timeout handl transactioncontext class need sinc 's task transact manag context simpli remov timeout handl
explicit manag public api 'd like start use clirr maven plugin 1 make sure n't accident break backward compat public api notabl jackrabbit-api jackrabbit-jcr-common also start explicit manag api version expos part osgi packag metadata current public packag simpli get latest project version version number would better version explicit manag updat api actual chang propos use version annot bnd tool package-info.java file packag consid part public api clirr plugin flag chang made api easi way tell packag need version number updat 1 http //mojo.codehaus.org/clirr-maven-plugin/
incorrect html excerpt generat queri japanes text content generat excerpt highlight singl charact instead full word test case ad fulltextquerytest public void testjapaneseandhighlight throw repositoryexcept http //translate.google.com/ auto|en| e3 82 b3 e3 83 b3 e3 83 86 e3 83 b3 e3 83 88 string jcontent \u30b3\u30fe\u30c6\u30f3\u30c8 http //translate.google.com/ auto|en| e3 83 86 e3 82 b9 e3 83 88 string jtest \u30c6\u30b9\u30c8 string content text japanes jcontent content jtest test expect excerpt note may chang excerpt provid chang string expectedexcerpt div span text japanes jcontent content strong jtest /strong test /span /div node n testrootnode.addnod node1 n.setproperti titl content testrootnode.getsess .save string xpath /jcr root testroot /element nt unstructur jcr contain jtest /rep excerpt queri q superuser.getworkspac .getquerymanag .createqueri xpath query.xpath queryresult qr q.execut rowiter qr.getrow int cnt 0 it.hasnext cnt++ row found it.nextrow assertequ n.getpath found.getpath string excerpt found.getvalu rep excerpt .getstr assertequ expectedexcerpt excerpt assertequ 1 cnt
mandatori authent prevent webdav client connect seen mail list java -jar target/jackrabbit-standalone-2.3-snapshot.jar cli http //localhost:8080 except thread main javax.jcr.repositoryexcept unabl access repositori follow set org.apache.jackrabbit.repository.uri http //localhost:8080 follow repositoryfactori class consult org.apache.jackrabbit.jcr2dav.jcr2davrepositoryfactori declin org.apache.jackrabbit.jcr2spi.jcr2spirepositoryfactori declin org.apache.jackrabbit.commons.jndirepositoryfactori declin org.apache.jackrabbit.core.repositoryfactoryimpl declin org.apache.jackrabbit.rmi.repository.rmirepositoryfactori fail repositoryexcept fail read resourc url http //localhost:8080 ioexcept server return http respons code 401 url http //localhost:8080 perhap repositori tri access avail moment org.apache.jackrabbit.commons.jcrutils.getrepositori jcrutils.java:216 org.apache.jackrabbit.commons.jcrutils.getrepositori jcrutils.java:256 org.apache.jackrabbit.standalone.main.run main.java:127 org.apache.jackrabbit.standalone.main.main main.java:61
weightedhighlight encod xml markup charact see jcr-2611 problem appli weightedhighlight
add copymovehanld copy/mov behavior custom case iohandl propertyhandl iohandl impl let defin specif import/export behavior either specif nodetypes/locations/etc great work well creat modifi web dav resourc work copy/mov use case attach patch provid propos addit copymovehandl
add user changepassword string newpw string oldpw oldpw must match order password user success chang could done applic quit effort implement easili achiev function requir alreadi present
add usermanag getauthorizablebypath string symmetri jcr-3037 jcr-3037 ad authoriz getpath would suggest also add usermanag getauthorizablebypath symmetr authoriz getpath
occasion index bound except run usermanagerimpltest.testfindauthorizablebyrelativepath stack trace java.lang.arrayindexoutofboundsexcept 8 org.apache.jackrabbit.core.query.lucene.multiscorer.scor multiscorer.java:89 org.apache.lucene.search.conjunctionscorer.scor conjunctionscorer.java:133 org.apache.lucene.search.booleanscorer2 2.score booleanscorer2.java:182 org.apache.lucene.search.booleanscorer2.scor booleanscorer2.java:303 org.apache.jackrabbit.core.query.lucene.lucenequeryhits.nextscorenod lucenequeryhits.java:68 org.apache.jackrabbit.core.query.lucene.queryhitsadapter.nextscorenod queryhitsadapter.java:54 org.apache.jackrabbit.core.query.lucene.filtermulticolumnqueryhits.nextscorenod filtermulticolumnqueryhits.java:63 org.apache.jackrabbit.core.query.lucene.queryresultimpl.collectscorenod queryresultimpl.java:328 org.apache.jackrabbit.core.query.lucene.queryresultimpl.getresult queryresultimpl.java:291 org.apache.jackrabbit.core.query.lucene.singlecolumnqueryresult. init singlecolumnqueryresult.java:66 org.apache.jackrabbit.core.query.lucene.queryimpl.execut queryimpl.java:134 org.apache.jackrabbit.core.query.queryimpl 1.perform queryimpl.java:130 org.apache.jackrabbit.core.query.queryimpl 1.perform queryimpl.java:1 org.apache.jackrabbit.core.session.sessionstate.perform sessionstate.java:200 org.apache.jackrabbit.core.query.queryimpl.execut queryimpl.java:126 org.apache.jackrabbit.core.security.user.indexnoderesolver.findnod indexnoderesolver.java:109 org.apache.jackrabbit.core.security.user.usermanagerimpl.findauthoriz usermanagerimpl.java:498 org.apache.jackrabbit.core.security.user.usermanagerimpl.findauthoriz usermanagerimpl.java:462 org.apache.jackrabbit.core.security.user.usermanagerimpltest.testfindauthorizablebyrelativepath usermanagerimpltest.java:560 sun.reflect.nativemethodaccessorimpl.invoke0 nativ method sun.reflect.nativemethodaccessorimpl.invok unknown sourc sun.reflect.delegatingmethodaccessorimpl.invok unknown sourc java.lang.reflect.method.invok unknown sourc junit.framework.testcase.runtest testcase.java:154 junit.framework.testcase.runbar testcase.java:127 junit.framework.testresult 1.protect testresult.java:106 junit.framework.testresult.runprotect testresult.java:124 junit.framework.testresult.run testresult.java:109 junit.framework.testcase.run testcase.java:118 org.apache.jackrabbit.test.abstractjcrtest.run abstractjcrtest.java:456 junit.framework.testsuite.runtest testsuite.java:208 junit.framework.testsuite.run testsuite.java:203 org.eclipse.jdt.internal.junit.runner.junit3.junit3testreference.run junit3testreference.java:130 org.eclipse.jdt.internal.junit.runner.testexecution.run testexecution.java:38 org.eclipse.jdt.internal.junit.runner.remotetestrunner.runtest remotetestrunner.java:467 org.eclipse.jdt.internal.junit.runner.remotetestrunner.runtest remotetestrunner.java:683 org.eclipse.jdt.internal.junit.runner.remotetestrunner.run remotetestrunner.java:390 org.eclipse.jdt.internal.junit.runner.remotetestrunner.main remotetestrunner.java:197
degrad grace read invalid date valu note jcr-1996 possibl old version jackrabbit store date invalid date valu repositori current valu caus except repositori attempt read better approach would automat detect date map instead string valu avoid lose inform client could access inform string normal jcr api would get valueformatexcept tri read valu date i.e use getdat method
script check releas script autom check releas similar 0 heavili inspir sling script command line call look like ./check-release.sh jukka 1.6.5 4fa1e032f9b641fbc5c9ff8d6ba76fdb58b539ba command also embed email announc come releas anybodi easili run 0 http //svn.apache.org/repos/asf/sling/trunk/check_staged_release.sh
better diagnost version storag broken internalversionmanagerbas code n't null-check predecessor properti assum ll alway present case due repositori problem ll see npe propos add code generat meaning error messag make easier debug product
potenti infinit loop around internalversionimpl.getsuccessor 's infinit loop wait happen under persist version storag defect noformat org.apache.jackrabbit.core.version.internalversionimpl.getsuccessor internalversionimpl.java:148 org.apache.jackrabbit.core.version.internalversionhistoryimpl.init internalversionhistoryimpl.java:165 org.apache.jackrabbit.core.version.internalversionhistoryimpl.reload internalversionhistoryimpl.java:180 org.apache.jackrabbit.core.version.internalversionhistoryimpl.getvers internalversionhistoryimpl.java:299 noformat line number 2.2 happen version instanti reload call turn call init part piec code label fix legaci call getsuccessor turn want instanti version
javax.jcr.repositoryexcept join sql2 queri send via davex result see follow thread detail http //www.mail-archive.com/us jackrabbit.apache.org/msg17975.html assum data structur follow /foo nt unstructur /foo/bar nt unstructur /foo/bar lala huii lala string properti bar /ding nt unstructur /ding dong baruuid dong properti type refer follow code throw except davexcli client new davexcli url repositori repo client.getrepositori credenti sc new simplecredenti admin admin .tochararray session repo.login sc workspac querymanag qm s.getworkspac .getquerymanag string sql select data nt unstructur data data.lala= huii sql select nt unstructur data inner join nt unstructur refer refer dong data jcr uuid data.lala huii sql select nt unstructur data inner join nt unstructur refer isdescendantnod data refer data.lala huii queri queri qm.createqueri sql query.jcr_sql2 queryresult qr query.execut first queri work fine iter result neither second third queri work case end javax.jcr.repositoryexcept note except happen queri return result aka join work fine match row
setfetchs fail getallnodeid get follow except persistencemanageriteratortest window org.apache.jackrabbit.core.state.itemstateexcept getallnodeid fail org.apache.jackrabbit.core.persistence.pool.bundledbpersistencemanager.getallnodeid bundledbpersistencemanager.java:1043 org.apache.jackrabbit.core.data.persistencemanageriteratortest.testgetallnodeid persistencemanageriteratortest.java:106 caus java.sql.sqlexcept invalid paramet valu 10'000 statement.setfetchs int row org.apache.derby.impl.jdbc.sqlexceptionfactory40.getsqlexcept unknown sourc org.apache.derby.impl.jdbc.util.newembedsqlexcept unknown sourc org.apache.derby.impl.jdbc.util.newembedsqlexcept unknown sourc org.apache.derby.impl.jdbc.util.generatecssqlexcept unknown sourc org.apache.derby.impl.jdbc.embedconnection.newsqlexcept unknown sourc org.apache.derby.impl.jdbc.connectionchild.newsqlexcept unknown sourc org.apache.derby.impl.jdbc.embedstatement.setfetchs unknown sourc org.apache.commons.dbcp.delegatingstatement.setfetchs delegatingstatement.java:279 org.apache.commons.dbcp.delegatingstatement.setfetchs delegatingstatement.java:279 org.apache.jackrabbit.core.util.db.connectionhelper.reallyexec connectionhelper.java:372 org.apache.jackrabbit.core.util.db.connectionhelp 3.call connectionhelper.java:353 org.apache.jackrabbit.core.util.db.connectionhelp 3.call connectionhelper.java:349 org.apache.jackrabbit.core.util.db.connectionhelp retrymanager.dotri connectionhelper.java:472 org.apache.jackrabbit.core.util.db.connectionhelper.exec connectionhelper.java:349 org.apache.jackrabbit.core.persistence.pool.bundledbpersistencemanager.getallnodeid bundledbpersistencemanager.java:1020 's caus follow code connectionhelp 0 maxrow 10000 stmt.setmaxrow maxrow stmt.setfetchs 10000 simpl fix would stmt.setmaxrow maxrow stmt.setfetchs math.min 10000 maxrow
lucen scorer implement handl advanc no_more_doc optimis better lucen scorer actual docidsetiter api note method may call no_more_doc effici scorer implement effici determin exhaust recommend check valu call method none scorer implement current except childaxisscor thank jcr-3082 worthwhil effort save us bug jcr-3082 also leverag perform optimis hint lucen api
inconsist session.getproperti node.getproperti binari valu inconsist binari handl batch-read facil case properti direct access without access parent node issu came timothe maret run perform issu retriev length binari properti property-entri creat run batch-read oper correspond property-data object contain intern valu contain length binari transport json respons read data server valu stream explicit request howev properti access direct e.g session.getproperti node.getproperti relat path get request made correspond dav resourc stream read immedi possibl solut repositoryservic getiteminfo sessioninfo itemid call propertyid implement result get request correspond resourc call super.getpropertyinfo sessioninfo propertyid itemid instead consist batch-read make propfind request properti length return propertyinfo object would case ident one generat batch-read function
move oper may turn ac cach stale entrycollector instanc associ given workspac listen modif made access control content add modif remov access control list howev due structur ac content ac node attach affect node cach may becom stale node move contain ac inform somewher subtre order circumv problem entrycollector addit collect kind move oper make sure cach updat accord
add hit miss statist log cach current cach concurrentcach n't maintain hit miss statist make hard know need increas cach deploy function exist 1.5 1.6 branch miss 2.x branch patch add statist add log info level frequenc log default configur maxim minut configur system properti org.apache.jackrabbit.cachelogstatsinterv ms log line look like 07.10.2011 09:00:39 info org.apache.jackrabbit.core.persistence.bundle.abstractbundlepersistencemanager.logcachestat :737 name=defaultbundlecach concurrentcach 54fb02fd num=21074 mem=34504k max=65536k hits=93352 miss=21074 puts=21135 07.10.2011 09:00:40 info org.apache.jackrabbit.core.persistence.bundle.abstractbundlepersistencemanager.logcachestat :737 name=versionbundlecach concurrentcach 47b1de1a num=10637 mem=250k max=8192k hits=36352 miss=10637 puts=10637 patch also make possibl later expos statist jmx initi jmx work settl
recoveri tool recov version histori instanti root version jcr-2551 introduc recoveri mode tri instanti version histori fail disconnect vh version histori make node unvers howev appear happen persist damag get vh inde work subsequ oper fail due problem one problem seen miss frozennod properti root version miss frozennod quick fix may want chang checker actual also tri get rootvers 's frozennod long term depend frequent problem may think less drastic recoveri disconnect vh
internalversion.getfrozennod confus root version seem javadoc internalversion.getfrozennod confus return frozen node version code null /code root version afaiu frozen node root version alway present captur node type version node anybodi recal got svn say forev
npe version oper concurr internalversionmanagerbase.getparentnod occasion throw npe protect static nodestateex getparentnod nodestateex parent string uuid name internt throw repositoryexcept nodestateex n parent int 0 3 i++ name name getnam uuid.substr 2 2 2 n.hasnod name n n.getnod name 1 assert n null els internt null n.addnod name internt null fals n.store n n.getnod name 1 assert n null els return null return n appar getnod occasion return null due race condit chang code 's appear fix protect static nodestateex getparentnod nodestateex parent string uuid name internt throw repositoryexcept nodestateex n parent int 0 3 i++ name name getnam uuid.substr 2 2 2 nodestateex n2 n.getnod name 1 n2 null n n2 els internt null n2 n.addnod name internt null fals n.store n n2 els return null return n like move race condit somewher els
speed hierarchi cach initi initi workspac take quit long time big number node search index involv reason setup cachingindexread process use chunk certain size actual 400k order reduc memori footprint soon number document exceed limit oper actual travers complet index perform seem current algorithm initializepar cachingindexread class ca n't optim without increas memori consumpt therefor promis approach persist state class actual 's main member array map reload startup load state done implicit initi phase cach obvious correct point time call save oper n't obvious tri doclos method class seem suffici
sql2 isdescendantnod throw booleanqueri toomanyclaus mani match child node run queri isdescendantnod claus easili go max claus limit lucen 's booleanqueri 's bigger hierarchi involv
move persistencemanagertest o.a.j.cor o.a.j.core.persist subject pretti much sum pmtest place togeth pm relat test o.a.j.core.persist
qnodetypedefinitionimpl.getserializablepropertydef might return non serializ properti definit qnodetypedefinitionimpl.getserializablepropertydef return set-vers pass paramet irrespect whether properti def serializ see http //markmail.org/thread/65ngqvyxnu4nn3su
internalversionmanagerbas miss null check getnod least two instanc check node hasnod call getnod without check null
nodetypedefdiff.propdefdiff.init constraint chang check bug two bug found nodetypedefdiff.propdefdiff.init tri modifi properti constraint alreadi regist node type 1 accord java doc possibl remov constraint properti mark major chang 2 's allow trivial set constraint properti constraint wrong could affect consist exist repositori content
expos pm version manag consist check run test case need abl run pm consist check version store well
version fixup leav persist state node ca n't made version jackrabbit 's version recoveri mode org.apache.jackrabbit.version.recoveri system properti disconnect version histori expos problem manifest unexpect except thrown disconnect mean remov properti defin mix version remov mixin type actual version relat node remain place problem re-ad mix version itemsaveoperation.initversionhistori tri creat new version histori locat path deriv version node 's identifi consequ fail broken under storag attach work-in-progress test case illustr problem
cluster node id trim cluster node id configur repository.xml read file cluster_node.id instead case file edit hand editor e.g vi insert trail newlin charact \n lead cluster node id contain blank charact n't expect caus issu inconveni debug also introduc line-break log file suggest trim cluster node id non-blank charact use
stat persistencemanag statist persistencemanag impl cover bundl cach access count bundl cach miss count bundl cach miss avg durat avg includ penalti load under storag interpret avg read latenc cach involv bundl write per second n't cover number bundl size workspac valu expens comput demand cach would impli abl store valu possibl current
configur action upon authoriz creation remov would like add possibl configur custom action execut upon user group creation oper persist would allow applic run custom code without need subclass usermanag implement e.g creat addit mandatori properti set permiss calcul default group membership appli user/group remov
improv aggreg node index code current aggreg node index code use sub-optim way copi sort aggreg field
chang log level usermanagerimpl getauthoriz nodeimpl userimport handlepropinfo current implement authoriz getauthoriz nodeimpl n throw repositoryexcept authoriz authorz null n null string path n.getpath n.isnodetyp nt_rep_us text.isdescend userspath path authorz createus n els n.isnodetyp nt_rep_group text.isdescend groupspath path authorz creategroup n els els node type outsid valid user/group hierarchi return null log.debug unexpect user nodetyp n.getprimarynodetyp .getnam els match node return null return authorz seem els branch improv least increas log level think best way throw except current messag also mislead case user type correct check text.isdescend fail method call within userimport handlepropinfo authoriz usermanager.getauthoriz parent null log.debug handl protect propinfo protectedpropinfo node parent n't repres valid authoriz return fals log level debug point return statement properti principalnam set tri save session follow except thrown javax.jcr.nodetype.constraintviolationexcept /home/public/users/b/bb2 mandatori properti intern password exist org.apache.jackrabbit.core.itemsaveoperation.validatetransientitem itemsaveoperation.java:537 org.apache.jackrabbit.core.itemsaveoperation.perform itemsaveoperation.java:216 org.apache.jackrabbit.core.session.sessionstate.perform sessionstate.java:200 org.apache.jackrabbit.core.itemimpl.perform itemimpl.java:91 org.apache.jackrabbit.core.itemimpl.sav itemimpl.java:329 log level set debug obvious mention properti miss use case root caus path /home/public/users/b/bb2 descend userspath /home/us regard miroslav
queryobjectmodelimpl execut queri sessionoper queryobjectmodelimpl n't leverag sessionoper closur approach like queryimpl switch style run queri yield gain speed ran 50 queri per test 1. old style code chang avg 14.26 ms 2. new style session oper avg 12.14 ms 3. new style session oper avg 6.44 ms 4. new style session oper avg 6.68 ms 5. old style code chang avg 11.62 ms 6. old style code chang avg 11.66 ms
stat queri re-en stat queri disabl refactor phase
credentialswrapp use empti string userid custom credenti use custom credenti use get illegalargumentexcept abstractqvaluefactori execut sessionitemstatemanager.computesystemgeneratedpropertyvalu 2 properti jcr createdbi jcr lastmodifi could creat
upgrad tika 0.10 apach tika 0.10 releas ago contain lot improv fix full text extract
problem former escap jcr node name upgrad jackrabbit 2.2.9 follow unit test fail code import static org.junit.assert import org.apache.jackrabbit.util.text import org.junit.test public class testescap test public void testescap throw except expect escap string e.g former escap jackrabbit 1.6 string escap nam 27e string unescap text.unescapeillegaljcrchar escap assertequ escap text.escapeillegaljcrchar unescap code major problem upgrad 1.6.x 2.2.9 node name escap jackrabbit 1.6 longer escap break backward compat think problem come jcr-2198
possibl creat non-transi repositori insid jcarepositorymanag jcr-2555 jukka chang code creat repositori repositoryfactori mechan possibl creat non-transi repositori
npe itemmanag call session.sav noth save 'm get npe id.denotenod call itemmanag privat itemdata retrieveitem itemid id synchron itemcach itemdata data itemcache.get id data null id.denotesnod id null take second branch sessionsaveoperation.perform context.getsessionimpl .haspermiss session.action_read id context.getrootnodeid els id context.getitemstatemanag .getidofroottransientnodest context.tostr say session-author-3623 itemmanag org.apache.jackrabbit.core.itemmanag 1e911ccc item cach sessionitemstatemanag org.apache.jackrabbit.core.state.sessionitemstatemanag 15472b43 transient attic assum mean 's noth save correct behavior probabl noth perform avoid npe
test tool updat leverag advanc test tool 'd like upgrad junit depend 4.x switch use maven failsaf plugin 1 instead current custom pom set integr test ll also upgrad easymock depend 3.0 1 http //maven.apache.org/plugins/maven-failsafe-plugin/
queri stat use timeseri mechan refactor queri stat use timeseri averag queri durat
upgrad logback 1.0 logback 1.0 releas see http //mailman.qos.ch/pipermail/announce/2011/000093.html big new featur major chang bump 1.0 still good point us upgrad get latest bug fix improv time upgrad slf4j deped latest 1.6.4 version
add m2e lifecycl map eclips indigo import jackrabbit latest eclips releas indigo come m2e version 1.0 mani pom flag red m2e n't know custom plugin map use mani compon pretti contenti issu m2e see exampl https //bugs.eclipse.org/bugs/show_bug.cgi id=350414 ideal work without custom workaround part howev workaround core issu solv best solut explicit tell m2e plugin map extra org.eclipse.m2 lifecycle-map configur activ use within eclips n't affect normal build
skip sync delay chang found cluster synchron slave alway wait time specifi sync delay fetch chang lot chang written master slave consider fall behind master term revis may endang integr cluster master crash therefor suggest slave rather immedi contact master chang found see chang
miss sync internalversionmanagerimpl.externalupd caus concurrentmodificationexcept map.entri itemid internalversionitem entri versionitems.entryset changes.ha entry.getkey items.add entry.getvalu need sync versionitem believ
add configur hook password valid 's common use case applic would like enforc addit logic associ chang user password current achiev use deriv user implement extend function ad jcr-3118 fair trivial provid hook custom password valid check write password expir date etc.etc
upgrad tika 1.0 tika 1.0 releas today mani improv earlier 0.10 releas upgrad
creat osgi bundl jackrabbit-webdav jackrabbit-jcr-serv librari propos generat bundl jackrabbit-webdav export everyth jackrabbit-jcr-serv export noth librari addit new class ad jackrabbit-jcr-serv librari case deploy osgi framework regist servlet osgi httpservic expos jcrremotingservlet
sessionimpl issupportedopt skip descriptor evalu descriptor load followup issu jcr-3076 jukka state chang jcr-server serv repository-descriptor without mandat success login would requir quit chang server side current flow demand success repositori login order access resourc includ root resourc act parent avail workspac sinc repository-descriptor report request one resourc also mandat success login although retriev descriptor jcr-level possibl repositori hand hand would assum descriptor function present repositori rare use therefor would suggest relax check support option jcr2spi session implement skip evalu descriptor n't avail consequ failur non-support featur would postpon point reach spi instead inform api consum upfront hand support oper would fail descriptor load
text extract may congest thread pool repositori text extract congest thread pool repositori e.g mani pdfs load workspac task submit index merger delay result mani index segment folder
use transact still lead memori leak result way jcr-395 fix look code ll see txglobal.remov xid call last statement xasessionimpl.commit xasessionimpl.rollback howev method except could thrown either result call tx.commit tx.prepar tx.rollback result transact remov txglobal whenev commit rollback fail reason suggest would move txglobal.remov xid final block
accesscontrolprovid geteffectivepolici set princip includ repo-level ac jcr-2774 resourc base ac implement allow edit permiss repositori level oper howev aclprovid geteffectivepolici set princip compiledpermiss includ repo level ac result set due miss test regular acl repo-level acl
sharedfieldcach caus memori leak sharedfieldcach problem way build cach key indexread valu inner cach anoth map key static inner class call key key hold refer compar use queri ran assum compar type extend abstractfieldcompar think custom jr compar keep refer inderread instanc order abl load valu compar circl complet sharedfieldcach entri never get gc'ed one option would implement purg method cach similar lucen mechan inderread get close could call purg ugli n't seem work well radic option remov cach complet instanc simplefieldcompar client cach alreadi build array avail valu cach would help instanc type ll analyz propos solut patch follow short remov compar refer key class look like real purpos impact equal key make sens first place lucen queri use compar info anyth use field 2 differ compar ll get 2 differ cach entri base valu lucen index feedback appreci
accesscontrolimport import repo level ac content implement protectednodeimport respons deal access control content adjust proper cope repositori level access control may store togeth root node use access control api null path
stat queri continu track last miss item queri stat list top queri also need refactor
group getmemb may list inherit member multipl time happen detect follow regress seem introduc quit ago group getmemb defin return group member includ inherit anoth group member group exampl user group declar member group b declar member group c b declar member expect result group.getmemb b t. current happen includ twice return iter quick test jackrabbit 2.0 reveal use work n't care check bug introduc refactor membership collect seem possibl culprit
deadlock dbcp access node found deadlock situat use jr 2.2.10 problem dbcp 1.2.2 fix dbcp 1.3 jr trunk also use dbcp 1.2.2 also updat ticket dbcp dbcp-270 relat ticket dbcp-65 dbcp-281 dbcp-271 stack trace call stall code main 1 prio=5 group main status monitor block timer-1 2545 wait timer-1 2545 releas lock 1 org.apache.commons.pool.impl.genericobjectpool.addobjecttopool genericobjectpool.java:1137 org.apache.commons.pool.impl.genericobjectpool.returnobject genericobjectpool.java:1076 org.apache.commons.dbcp.poolableconnection.clos poolableconnection.java:87 org.apache.commons.dbcp.poolingdatasourc poolguardconnectionwrapper.clos poolingdatasource.java:181 org.apache.jackrabbit.core.util.db.dbutility.clos dbutility.java:75 org.apache.jackrabbit.core.util.db.resultsetwrapper.invok resultsetwrapper.java:63 proxy12.clos unknown sourc -1 org.apache.jackrabbit.core.persistence.pool.bundledbpersistencemanager.loadbundl bundledbpersistencemanager.java:1042 org.apache.jackrabbit.core.persistence.bundle.abstractbundlepersistencemanager.getbundl abstractbundlepersistencemanager.java:669 org.apache.jackrabbit.core.persistence.bundle.abstractbundlepersistencemanager.load abstractbundlepersistencemanager.java:415 org.apache.jackrabbit.core.state.shareditemstatemanager.loaditemst shareditemstatemanager.java:1830 org.apache.jackrabbit.core.state.shareditemstatemanager.getnonvirtualitemst shareditemstatemanager.java:1750 org.apache.jackrabbit.core.state.shareditemstatemanager.getitemst shareditemstatemanager.java:265 org.apache.jackrabbit.core.state.localitemstatemanager.getnodest localitemstatemanager.java:109 org.apache.jackrabbit.core.state.localitemstatemanager.getitemst localitemstatemanager.java:174 org.apache.jackrabbit.core.state.xaitemstatemanager.getitemst xaitemstatemanager.java:260 org.apache.jackrabbit.core.state.sessionitemstatemanager.getitemst sessionitemstatemanager.java:161 org.apache.jackrabbit.core.itemmanager.getitemdata itemmanager.java:382 org.apache.jackrabbit.core.itemmanager.getnod itemmanager.java:669 org.apache.jackrabbit.core.itemmanager.getnod itemmanager.java:647 org.apache.jackrabbit.core.lazyitemiterator.prefetchnext lazyitemiterator.java:120 org.apache.jackrabbit.core.lazyitemiterator.next lazyitemiterator.java:257 info.magnolia.jcr.iterator.delegatingnodeiterator.next delegatingnodeiterator.java:79 code offend thread code timer-1 2545 daemon prio=5 group main status monitor block main 1 wait main 1 releas lock 1 org.apache.commons.dbcp.abandonedtrace.addtrac abandonedtrace.java:176 org.apache.commons.dbcp.abandonedtrace.init abandonedtrace.java:92 org.apache.commons.dbcp.abandonedtrace. init abandonedtrace.java:82 org.apache.commons.dbcp.delegatingstatement. init delegatingstatement.java:61 org.apache.commons.dbcp.delegatingconnection.createstat delegatingconnection.java:224 org.apache.commons.dbcp.poolableconnectionfactory.validateconnect poolableconnectionfactory.java:331 org.apache.commons.dbcp.poolableconnectionfactory.validateobject poolableconnectionfactory.java:312 org.apache.commons.pool.impl.genericobjectpool.evict genericobjectpool.java:1217 org.apache.commons.pool.impl.genericobjectpool evictor.run genericobjectpool.java:1341 java.util.timerthread.mainloop timer.java:512 java.util.timerthread.run timer.java:462 code
lower operand nest localnam operand work sql2 queri run success use query.sql languang select nt file contain jon lower fn name like jon jcr path like /resources/ order jcr score equival next queri query.jcr_sql2 fail except unsupportedrepositoryoperationexcept select nt file contain nt file jon lower localnam like jon isdescendantnod /resourc order score investig seem lower function work nest function localnam accord section 6.7.32 lowercas jcr 2.0 spec lower operand abl work dynamicoperand argument
session move n't trigger rebuild parent node aggreg summari say
add jcrutils.getpropertytypenam properti relat ui common popul list properti type name instead hardcod various place list could provid jcrutil
index updat overhead cluster slave due jcr-905 jcr-905 quick dirti fix caus overhead cluster slave node process revis
npe repositoryserviceimpl.getpropertyinfo unknown condit get npe get properti info getvalu getstr dav properti null els props.contain jcr_get_str singl valu non-binari properti string str props.get jcr_get_str .getvalu .tostr qvalu qvalu valueformat.getqvalu str propertytyp getnamepathresolv sessioninfo getqvaluefactori sessioninfo return new propertyinfoimpl propertyid p propertytyp qvalu els properti propset getstr null type string length 0 properti question last properti node 's empti string error occur certain usag pattern consist mayb depend fetch-depth intern cach extend check els props.contain jcr_get_str props.get jcr_get_str .getvalu null solv problem
consolid compar behaviour valu compar 2 differ implement valu comparison valuecompar util introduct jcr-2906 introduc array mix 'd like refactor one place name o.a.j.core.query.lucene.util also allow wider scope comparison valu mark todo valuecompar class attach patch short
make jackrabbit compil java 7 compil java 7 fail follow error jackrabbit-core/src/main/java/org/apache/jackrabbit/core/util/db/datasourcewrapper.java 30,7 error datasourcewrapp abstract overrid abstract method getparentlogg commondatasourc fix
precompil javacc parser jackrabbit-spi-common javacc-gener java sourc file jackrabbit-spi-common requir special configur import jackrabbit sourc ide like eclips make ide integr smoother would nice precompil copi java file exist src/main/java folder precompil sourc would also allow us avoid javacc process step jackrabbit build instead could separ profil explicit recompil javacc sourc modifi past three year happen jcr-952 think bit extra complex justifi simplif achiev normal build ide integr
implement persist event eventjourn see http //www.day.com/specs/jcr/2.0/12_observation.html 12.6.3 20event 20bundl 20in 20journal 20observ
destin uri normal webdavrequestimpl.gethrefloc test uri pass paramet start context path pass next segment locat factori potenti hole paramet contain http //example.com/dav/../foo start context path http //example.com/dav repres http //example.com/foo current locat factori detect situat mean everi locat factori implement check addit davlocatorfactory.createresourceloc throw except henc would fail clean runtimeexcept caus 500 intern server error respons 403 forbidden status code would apropri note request-uri alreadi normal servlet contain copy/mov oper destination-uri normal conform client must use dot-seg rfc 4918 section 8.3 simple-ref construct destin header rfc 4918 section 10.3 server abl detect error propos chang webdavrequestimpl:193 packag org.apache.jackrabbit.webdav webdav/java ref uri.getrawpath ref uri.norm .getrawpath caus /dav/../foo reject n't start context path accept dav/foo/../bar start context path
inputcontextimpl upload file larger 2gb entiti larger 2gb content-length obtain use getinthead integ overflow one need pars valu header string long issu affect inputcontextimpl.getcontentlength org.apache.jackrabbit.webdav.io webdav/java current behavior header convert string int servlet api int long jackrabbit testcas largefil litmus test 3 large_put fail put request receiv
jcarepositorymanag close inputstream jcr-3129 open alreadi close issu jcr-1667
remov jdk 1.4 restrict jcr-test restrict exist test form tck jsr-283 need support jdk 1.4 mainten jsr-283 tck need happen previous branch 2.3
improv error messag index aggreg case index aggreg fail node n't exist log warn messag contain full stack-trac besid fact mislead may think 's someth wrong need fix right away also borderlin useless desir behavior would log info messag mention certain node skip similar seachmanag
add test case recov broken version histori hierarchi test exercis recoveri miss parent node vhr
add memori base bundl store
extend consistencycheck api allow adopt orphan node to-be-specifi parent node option consistencycheck api persist manag allow analyz fix storag inconsist current fixup code though attempt adopt orphan node
refactor consist check bundledbpersistencemanag standalon class could re-us pms see subject
jcarepositorymanager.createnontransientrepositori throw npe jcamanagedconnectionfactory.configfile_key jcarepositorymanager.createnontransientrepositori fail string configfil parameters.get jcamanagedconnectionfactory.configfile_key null config repositoryconfig.cr configfil homedir alway throw npe perhap call config repositoryconfig.cr homedir
updat commons-io depend versiom 1.4 2.0.1 jackrabbit may use jackrabbit-jca mani applic server need chang classload polici global flat classload polici result mani conflict version server implement version applic would diminish jackrabbit depend keep up-to-d depend groupid commons-io /groupid artifactid commons-io /artifactid version 2.0.1 /version /depend
javadoc jackrabbit-jcr-rmi miss end javadoc file /jackrabbit-jcr-rmi/src/main/javadoc/apache/rmi/observation/package.html miss final end bodi tag
concurrentmodificationexcept cachemanag use test code abl produc stack java.util.concurrentmodificationexcept java.util.weakhashmap hashiterator.nextentri weakhashmap.java:762 java.util.weakhashmap keyiterator.next weakhashmap.java:795 org.apache.jackrabbit.core.cache.cachemanager.logcachestat cachemanager.java:164 org.apache.jackrabbit.core.cache.cachemanager.cacheaccess cachemanager.java:137 org.apache.jackrabbit.core.cache.abstractcache.recordcacheaccess abstractcache.java:122 org.apache.jackrabbit.core.cache.concurrentcache.get concurrentcache.java:122 org.apache.jackrabbit.core.state.mlruitemstatecache.retriev mlruitemstatecache.java:71 org.apache.jackrabbit.core.state.itemstatereferencecache.retriev itemstatereferencecache.java:139 org.apache.jackrabbit.core.state.shareditemstatemanager.getnonvirtualitemst shareditemstatemanager.java:1716 org.apache.jackrabbit.core.state.shareditemstatemanager.getitemst shareditemstatemanager.java:268 org.apache.jackrabbit.core.state.localitemstatemanager.getnodest localitemstatemanager.java:110 org.apache.jackrabbit.core.state.localitemstatemanager.getitemst localitemstatemanager.java:175 org.apache.jackrabbit.core.state.xaitemstatemanager.getitemst xaitemstatemanager.java:260 org.apache.jackrabbit.core.state.sessionitemstatemanager.getitemst sessionitemstatemanager.java:161 org.apache.jackrabbit.core.itemmanager.getitemdata itemmanager.java:382 org.apache.jackrabbit.core.itemmanager.getitem itemmanager.java:328 org.apache.jackrabbit.core.itemmanager.getitem itemmanager.java:622 org.apache.jackrabbit.core.itemmanager.getrootnod itemmanager.java:531 org.apache.jackrabbit.core.sessionimpl.getrootnod sessionimpl.java:760 test.jackrabbittest 1.run jackrabbittest.java:37 java.util.concurrent.threadpoolexecutor worker.runtask threadpoolexecutor.java:886 java.util.concurrent.threadpoolexecutor worker.run threadpoolexecutor.java:908 java.lang.thread.run thread.java:662 packag test import java.io.fil import java.util.concurrent.executorservic import java.util.concurrent.executor import java.util.concurrent.timeunit import java.util.concurrent.atomic.atomicboolean import java.util.concurrent.atomic.atomicinteg import javax.jcr.repositori import javax.jcr.repositoryexcept import javax.jcr.sess import javax.jcr.simplecredenti import org.apache.jackrabbit.core.transientrepositori public class jackrabbittest public static void main final string arg throw except file dir file.createtempfil jackrabbit-test dir.delet dir.mkdir system.out.println creat temporari directori dir.getabsolutepath dir.deleteonexit final repositori jcrrepo new transientrepositori dir final atomicboolean pass new atomicboolean true final atomicinteg counter new atomicinteg 0 executorservic executor executors.newfixedthreadpool 50 runnabl runnabl new runnabl overrid public void run tri session session jcrrepo.login new simplecredenti admin admin .tochararray session.getrootnod .addnod n counter.getandincr //uniqu name session.sav session.logout catch repositoryexcept e e.printstacktrac passed.set fals system.out.println run thread int 0 500 i++ executor.execut runnabl executor.shutdown //disabl new task submit executor.awaittermin 120 timeunit.second system.err.println timeout system.exit 1 passed.get system.err.println one thread got except system.exit 1 els system.out.println thread ran except system.exit 0
wrong assumpt test case lock token sever test case assum lock.getlocktoken return null lock attach current session howev option cite javadoc getlocktoken may return lock token lock lock open-scop current session either hold lock token lock repositori choos expos lock token current session method return lock token otherwis method return code null /code
broken handl outer join result davex davex join support ad jcr-3089 work correct join return least one row none return row contain null valu selector reason straightforward fix
workspace-wid default lock timeout way defin workspace-wid default jcr lock timeout case code creat lock specifi one
consist check get node id chunk reli total count pm consist checker use page featur fetch nodeid chunk also reli total number id log purpos
authorizableimpl memberof declaredmemberof return rangeiter would favor iter return authoriz memberof declaredmemberof would return rangeiter order caller determin size without iter
groupimp getmemb getdeclaredmemb return rangeiter case total amount member easili detected/calcul implement group getmemb getdeclaredmembersof return rangeiter far found group declaredmemb easili adjust case group member store multivalu properti
miss support lock timeout ownerhint jcr-server tri set lock timeout creat lock seem work davex transport timeout alway 2147483. test code import javax.jcr import javax.jcr.lock import org.apache.jackrabbit.jcr2spi.repositoryimpl import org.apache.jackrabbit.jcr2spi.config.repositoryconfig string url http //localhost:8080/server/ string workspac test repositoryconfig config new repositoryconfigimpltest repourl repositori repo repositoryimpl.cr config credenti sc new simplecredenti admin admin .tochararray session repo.login sc workspac node s.getrootnod .hasnod test s.getrootnod .getnod test els s.getrootnod .addnod test nt unstructur t.addmixin mix lockabl s.save lockmanag m s.getworkspac .getlockmanag lock l m.lock t.getpath fals true 10 system.out.println l.getsecondsremain output 2147483 relev communic fragment attach full trace case miss someth lock /server/tests/jcr 3aroot/test http/1.1 timeout second-10 depth 0 link urn uuid0c740bb9-042a-4ef2-b019-1a6c52784c29 rel= http //www.day.com/jcr/webdav/1.0/session-id author basic ywrtaw46ywrtaw4= user-ag jakarta commons-httpclient/3.0 host localhost:8080 content-length 254 content-typ text/xml charset=utf-8 xml version= 1.0 encoding= utf-8 standalone= d lockinfo xmlns d= dav d lockscop dcr exclusive-session-scop xmlns dcr= http //www.day.com/jcr/webdav/1.0 /d lockscop d locktyp d write/ /d locktyp d owner /d owner /d lockinfo http/1.1 200 ok content-typ text/xml charset=utf-8 content-length 450 lock-token aa724c28-3c24-41e8-a3b4-9fc129adf732 server jetti 6.1.x xml version= 1.0 encoding= utf-8 standalone= d prop xmlns d= dav d lockdiscoveri d activelock d lockscop dcr exclusive-session-scop xmlns dcr= http //www.day.com/jcr/webdav/1.0 /d lockscop d locktyp d write/ /d locktyp d depth 0 /d depth d timeout second-2147483 /d timeout d owner admin /d owner d locktoken d href aa724c28-3c24-41e8-a3b4-9fc129adf732 /d href /d locktoken /d activelock /d lockdiscoveri /d prop way explicit logout program exit lock also releas even though session base session trigger logout destruct
lock token valid sever minor issu map jcr lock token webdav lock token 1 webdav lock token suppos use uri syntax opaquelocktoken urn uuid 2 server current comput lock token session-scop lock base node id valid jcr lock token though caus except re-ad appear lock-token header header like caus request fail use type lock yes mayb academ fix anyway propos map lock token oqaquelocktoken uri use constant uuid plus postfix encod origin lock token b use syntax allow distinguish token open-scop lock session-scop lock tri add latter type session altern handl except grace
npe spi2dav server send header valueload may throw npe desir header present respons org.apache.jackrabbit.spi2davex.valueload public map string string loadhead string uri string headernam throw ioexcept repositoryexcept string name headernam headers.put name method.getresponsehead name .getvalu case server return etag respons header loadhead indirect call qvaluefactoryimpl this.preiniti new string header_etag header_last_modifi
add tck test info map node_mov event node reorder add tck test problem mark known test failur
speed nodeindexer.isindex check isindex method call everi valu multi-valu properti may quit expens lot valu
lock weird number infinit follow-up jcr-3205 surpris davex repli lock request infinit timeout fix jcr-3205 d timeout second-2147483 /d timeout number 2^21+50331 seem pretti random coincid number exact 2^31 1 2147483647 without last 3 digit weird string oper happen server side
fetch node id check checker queri use order bundleselectallidssql queri bundleselectallidsfromsql use order
userimport trigger execut authorizableact case user/group creation accord new implement specif extens made user mangement jcr-3118 user-import adjust well
simpl webdav server support lock timeout simpl webdav server still support lock timeout http trace show ms word request 3600s timeout get infin
allow servlet filter specifi custom session provid order integr jackrabbit davex server function custom authent logic sling project current need emb subclass davex servlet class would cleaner tight coupl n't need one way achiev someth like would allow extern compon provid custom sessionprovid instanc extra request attribut way exampl servlet filter implement custom authent logic could easili make function avail standard davex servlet jackrabbit
disallow unregist node type still possibl use
systemsess createsess return sessionimpl long fix jcr-2890 revis 1089436 behavior systemsess createsess chang return systemsess instead sessionimpl use basic consid move correct better way deal session-clon mechan prevent user method convert systemsess regular session extra write oper e.g access control edit support system session prevent chicken-egg-problem repo startup therefor would like revert chang 2.4 releas order prevent regress time 2.4 would howev suggest final take time clear defin usag abil respons system session also review expos individu modul jackrabbit core.. start work decid definit riski 2.4 wherea revert chang mention imo impos limit risk usag session awar use session sesssionimpl even access systemsess class
concurrentmodificationexcept querystatimpl run qurystat enabl queri execut throw concurrentmodificationexcept caus iter back collect chang anoth thread see logqueri method iter querystatdtoimpl iter popularqueries.iter iterator.hasnext querystatdtoimpl qsdi iterator.next qsdi.equ qs qs.setoccurrencecount qsdi.getoccurrencecount 1 iterator.remov break popularqueries.off qs
volatileindex close proper multiindex.resetvolatileindex method n't proper close exist volatileindex instanc creat new one confus dynamicpooledexecutor refer count ad jcr-2836 lead background thread leak
filerevis flag control whether sync file everi write filerevis class sync under revision.log file use everi write could perform problem add boolean flag control whether sync file everi write
replac bundlefspersistencemanag derbypersistencemanag jr core index test run jr core test yield deprec warn account workspac config outdat index test info o.a.j.core.config.beanconfig org.apache.jackrabbit.core.persistence.pool.bundlefspersistencemanag deprec pleas use org.apache.jackrabbit.core.persistence.bundle.bundlefspersistencemanag instead show 3 time log 3 index relat workspac need config updat
improv filerevis extens 'd nice make filerevis extens chane privat variabl protect extend easier need
querystat getpopularqueri n't set proper posit embarrass copy/past error updat wrong array posit info never return made jmx client fail javax.management.openmbean.tabulardatasupport.checkvalueandindex tabulardatasupport.java:871 javax.management.openmbean.tabulardatasupport.internalput tabulardatasupport.java:331 javax.management.openmbean.tabulardatasupport.put tabulardatasupport.java:323 org.apache.jackrabbit.core.jmx.querystatmanager.astabulardata querystatmanager.java:103
instanti lucen analyz searchindex lucen 3 default constructor anymor analyz class 11:46:45.946 main warn o.a.j.core.query.lucene.searchindex invalid analyz class org.apache.lucene.analysis.standard.standardanalyz java.lang.instantiationexcept org.apache.lucene.analysis.standard.standardanalyz java.lang.class.newinstance0 class.java:340 na:1.6.0_26 java.lang.class.newinst class.java:308 na:1.6.0_26 org.apache.jackrabbit.core.query.lucene.searchindex.setanalyz searchindex.java:1892 jackrabbit-core-2.4.0.jar:2.4.0 sun.reflect.nativemethodaccessorimpl.invoke0 nativ method na:1.6.0_26 sun.reflect.nativemethodaccessorimpl.invok nativemethodaccessorimpl.java:39 na:1.6.0_26 sun.reflect.delegatingmethodaccessorimpl.invok delegatingmethodaccessorimpl.java:25 na:1.6.0_26 java.lang.reflect.method.invok method.java:597 na:1.6.0_26 org.apache.jackrabbit.core.config.beanconfig.setproperti beanconfig.java:255 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.config.beanconfig.newinst beanconfig.java:203 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.config.repositoryconfigurationpars 1.getqueryhandl repositoryconfigurationparser.java:652 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.config.workspaceconfig.getqueryhandl workspaceconfig.java:251 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.searchmanager. init searchmanager.java:171 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.repositoryimpl workspaceinfo.getsearchmanag repositoryimpl.java:1855 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.repositoryimpl workspaceinfo.dopostiniti repositoryimpl.java:2092 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.repositoryimpl workspaceinfo.initi repositoryimpl.java:1997 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.repositoryimpl.initstartupworkspac repositoryimpl.java:510 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.repositoryimpl. init repositoryimpl.java:318 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.repositoryimpl.cr repositoryimpl.java:582 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.jndi.bindablerepository.createrepositori bindablerepository.java:141 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.jndi.bindablerepository.init bindablerepository.java:117 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.jndi.bindablerepository. init bindablerepository.java:106 jackrabbit-core-2.4.0.jar:2.4.0 org.apache.jackrabbit.core.jndi.bindablerepositoryfactory.getobjectinst bindablerepositoryfactory.java:52 jackrabbit-core-2.4.0.jar:2.4.0
add miss name constant mix titl
repositorystatist flexibl right jackrabbit report timeseri thing like bundle_read_count bundle_write_count etc way extend jackrabbit report timeseri addit properti 's type timeseri defin repositorystatist class type enum enum java extend limit timeseri type defin repositorystatist suggest repositorystatist improv allow addit timeseri one approach defin addit repositorystatist gettyp string method
sql2 isdescendantnod booleanqueri toomanyclaus return initi fix generic enough still fail ad twice max claus count
timeouthandl visitor extract dedic class minor problem ve stumbl upon look memori leak seem timeouthandl thread run second use custom elementvisitor busi creat new instanc elementvisitor second creat garbag could avoid use predefin class short stori unit test creat 3x instanc second 16 byte dedic visitor class creat 3 instanc lifespan repositori
webapp welcom page show incorrect port port default port see summari
set omit term freq posit flag parent field index flag omit term frequenc set true default chang constructor field class n't use info index anyway safe remov index size gain 130k node 3 leve ~50 node per level around 150kb 30mb index
make max size cachingentrycollector 's cach configur assist analyz bottleneck would good easi chang max size current hard-wir 5000 suggest pragmat system properti
access cluster node id need know cluster node id applic n't find way cast org.apache.jackrabbit.core.repositoryimpl repositoryimpl session.getrepositori .getconfig .getclusterconfig .getid would appreci could get use system properti clusternode.system_property_node_id
augment log inform around cachingentrycollector add log inform purpos debug cachingentrycollector bottleneck
problem bundledbpersistencemanag getallnodeid use mysql problem aris method paramet maxcount less total amount record bundl tabl first found mysql order nodeid object differ jackrabbit follow test describ idea public void testmysqlorderbynodeid throw except nodeid nodeid1 new nodeid 7ff9e87c-f87f-4d35-9d61-2e298e56ac37 nodeid nodeid2 new nodeid 9fd0d452-b5d0-426b-8a0f-bef830ba0495 preparedstat stmt connection.preparestat select node_id default_bundl node_id node_id order node_id object param new object nodeid1.getrawbyt nodeid2.getrawbyt stmt.setobject 1 param 0 stmt.setobject 2 param 1 arraylist nodeid nodeid new arraylist nodeid resultset resultset stmt.executequeri resultset.next nodeid nodeid new nodeid resultset.getbyt 1 system.out.println nodeid nodeids.add nodeid collections.sort nodeid nodeid nodeid nodeid system.out.println nodeid result follow output 7ff9e87c-f87f-4d35-9d61-2e298e56ac37 9fd0d452-b5d0-426b-8a0f-bef830ba0495 9fd0d452-b5d0-426b-8a0f-bef830ba0495 7ff9e87c-f87f-4d35-9d61-2e298e56ac37 problem getallnodeid method fetch extra 10 record top maxcount avoid problem first key one want afterward skip number record time use nodeid.compareto compareto statement return true unexpect mysql code n't expect mysql order situat 17000 record bundl tabl consecut get id thousand record time return 8000 record
oracl jdbc class cast except util oraclepersistencemanag packag org.apache.jackrabbit.core.persistence.db realiz mark deprec notic migrat jackrabbit 1.6.1 2.2.10/11 start applic server error messag display us indic connect object pass createtemporaryblob method blob class ca n't cast oracle.jdbc.oracleconnect interest line log 2012-03-15 17:15:47,926 error org.apache.jackrabbit.core.persistence.db.oraclepersistencemanag fail write node state cafebabe-cafe-babe-cafe-babecafebab java.lang.classcastexcept org.apache.commons.dbcp.poolingdatasourc poolguardconnectionwrapp cast oracle.jdbc.oracleconnect oracle.sql.blob.createtemporari blob.java:708 org.apache.jackrabbit.core.persistence.db.oraclepersistencemanager.createtemporaryblob oraclepersistencemanager.java:375 want highlight point see issu use oracl bundl persist manag howev due fact n't use bundl version past lot custom repo layout use bundl persist manag ran test notic consist check fail moment good upgrad path move repo bundl structur path provid thus far shaki best find solut problem shown issu thus far want share one line chang made wrap connect pass oracl driver org.apache.jackrabbit.core.util.db.connectionfactory.unwrap con solv problem also want share use xa datasourc
jcr-sql2 queri multipl column result return last column use row.getvalu run queri like in-process repositori via transientrepositori via rmi access call row.getvalu return last column select select property1 property2 nodetyp queryresult.getcolumnnam return right set column step code show org.apache.jackrabbit.core.query.lucene.join.abstractrow implement getvalu creat new valu array overwrit multipl time loop iter per column n't sound like desir behaviour get valu via individu call row.getvalu property1 give correct result
re-index fail corrupt bundl re-index process resili log error simpli continu next node n't seem use refus repositori startup case
error instanti lucen search index turkish region set issu chang region set turkish fail start repositori instanti lucen search index due follow issu org.apache.jackrabbit.core.config.configurationexcept configur class org.apache.jackrabbit.core.query.lucene.searchindex contain properti name indexingconfigur org.apache.jackrabbit.core.config.beanconfig.newinst beanconfig.java :205 org.apache.jackrabbit.core.config.repositoryconfigurationpars 1.getqu ryhandl repositoryconfigurationparser.java:631 org.apache.jackrabbit.core.config.repositoryconfig.getqueryhandl repo itoryconfig.java:1013 issu known java world due lower case convers charact turkish local jackrabbit sourc code tri instanti index configur repositori start access indexingconfigur properti instanti setter properti bad charact
eventconsumer.canread reli accessmanager.isgr current implement eventconsumer.canread use accessmanager.canread might caus issu item exist anymor accessmanager.isgr explicit mention support check path item yet exist exist anymor see also jcr-3271
audit log jcr-2031 ad user name path debug log audit purpos problem fix outlin comment jcr-2031 provid patch addit would use use add updat counter size inform debug log well someth like 17.03.2009 14:43:37 1 18216140 admin /apps/acme/templates/contentpage/thumbnail.png 12343 17.03.2009 14:43:37 2 18216141 admin /apps/acme/templates/contentpage/my.png 123 17.03.2009 14:43:37 3 18216142 admin /apps/acme/templates/contentpage/blah.png 1423 17.03.2009 14:43:37 4 18216143 admin /apps/acme/templates/contentpage/test.png 123423 17.03.2009 14:43:37 5 18216144 admin /apps/acme/templates/contentpage/test2.png 123423 date time counter txid userid path size also think whether want log part regular jackrabbit log separ audit log
sql2 join empti set effici seem case left side join n't contain hit queryengin unabl generat effici queri right side basic select possibl node see discuss context 0 exampl left side hit right side select fast given condit sql2 join left side took 18 ms. fetch 145 row sql2 join right side took 67 ms. fetch 0 row left side hit right select everyth sql2 join left side took 8 ms. fetch 0 row sql2 join right side took 845 ms. fetch 13055 row fetch 130k node n't keep 0 http //jackrabbit.510166.n4.nabble.com/strange-search-performance-problem-with-or-td4507121.html
optim usag norm signific potenti optim size search index seen case multipl segment number node rough 10 million size disk differ one segment 19 gb other around 3 gb major differ number field index larg segment signific field result larg norm file go implement see norm realli necessari disabl track norm wherev possibl
internalversionmanagerbase.calculatecheckinversionnam fail npe upon empti predecessor properti note happen inconsist version storag add check throw descript except